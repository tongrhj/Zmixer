<<<<<<< HEAD
/* globals Audio */
import React from 'react'
import classNames from 'classnames'

import './mixing.styl'

export default class Mixing extends React.Component {
  static propTypes = {
    // layers: React.PropTypes.arrayOf(React.PropTypes.shape({
    //   layerID: React.PropTypes.number.isRequired,
    //   volume: React.PropTypes.number.isRequired
    // })).isRequired
    checkView: React.PropTypes.func
  };

  constructor (props) {
    super(props)
    this.state = {
      samplenames: ['cafe', 'fire', 'jungle', 'rain', 'river', 'waves', 'wind'],
      hidden: false
    }
  }

  handleClick (e) {
    this.setState({hidden: true})
    this.props.checkView('compose')
  }

  render () {
    const mixingPanelClasses = classNames({
      'Mixing-panel': true,
      'Mixing-panel-hidden': this.state.hidden
    })

    return (
      <div className={mixingPanelClasses}>
        <header className='Mixing-header' onClick={this.handleClick.bind(this)}>
          <h1>Save</h1>
        </header>
        <section className='Mixing-section'>
          {this.state.samplenames.map((name, idx) => {
            return <Bubble label={name} key={idx}/>
          })
          }
        </section>
      </div>
    )
=======
import React from 'react'
import SoundBubble from './bubble'
import {sampleNames, bubbleSizes} from '../constants/AppConstants'
import partition from 'lodash.partition'

function shuffledList (size) {
  const original = []
  const shuffled = []
  for (let i = 0; i < size; i++) original.push(i)
  for (let i = size; i > 0; i--) {
    shuffled.push(original.splice(Math.floor(Math.random() * i), 1)[0])
>>>>>>> yongjun21/master
  }
  return shuffled
}

export default class MixingRoom extends React.Component {
  static propTypes = {
    layers: React.PropTypes.arrayOf(React.PropTypes.shape({
      sampleID: React.PropTypes.number.isRequired,
      volume: React.PropTypes.number.isRequired
    })).isRequired,
    volumeUp: React.PropTypes.func.isRequired
  };

  constructor (props) {
    super(props)
    this.state = {
      outer: shuffledList(sampleNames.length),
      inner: shuffledList(bubbleSizes.length)
    }
    this.shuffleBubbles = this.shuffleBubbles.bind(this)
  }

  shuffleBubbles () {
    this.setState({
      outer: shuffledList(sampleNames.length),
      inner: shuffledList(bubbleSizes.length)
    })
  }

  render () {
<<<<<<< HEAD
    // let bubbleSize = this.state.bubbleSize

    const bubbleClass = classNames({
      'Mixing-bubble': true,
      'Mixing-bubble-selected': this.state.selected,
      // ['Mixing-bubble-${bubbleSize}']: this.state.selected && (this.state.bubbleSize > 1)
      'Mixing-bubble-0': !this.state.selected && (this.state.bubbleSize === 0),
      'Mixing-bubble-2': this.state.selected && (this.state.bubbleSize === 2),
      'Mixing-bubble-3': this.state.selected && (this.state.bubbleSize === 3),
      'Mixing-bubble-cafe': this.props.label === 'cafe',
      'Mixing-bubble-fire': this.props.label === 'fire',
      'Mixing-bubble-jungle': this.props.label === 'jungle',
      'Mixing-bubble-rain': this.props.label === 'rain',
      'Mixing-bubble-river': this.props.label === 'river',
      'Mixing-bubble-seawaves': this.props.label === 'waves',
      'Mixing-bubble-wind': this.props.label === 'wind'
=======
    let basket = partition(this.state.outer, idx => {
      return this.props.layers.findIndex(layer => layer.sampleID === idx) > -1
    })
    basket[0] = basket[0].map(idx => {
      return this.props.layers.find(layer => layer.sampleID === idx)
    })
    basket[1] = basket[1].map(idx => {
      return {sampleID: idx, volume: 0}
    })
    basket = basket[0].concat(basket[1])
    basket = this.state.inner.map(idx => basket[idx])
    basket = basket.map((sample, idx) => {
      const bubbleProps = Object.assign(sample, {
        key: idx,
        size: bubbleSizes[idx],
        active: true,
        volumeUp: this.props.volumeUp
      })
      return <SoundBubble {...bubbleProps}/>
>>>>>>> yongjun21/master
    })

    return (
<<<<<<< HEAD
      <div {...bubbleProps} className={bubbleClass} onClick={this.handleClick.bind(this)}>
        <h1>{ this.props.label }</h1>
=======
      <div>
        <h3>Be creative</h3>
        <div>{basket}</div>
        <button onClick={this.shuffleBubbles}>Shuffle</button>
>>>>>>> yongjun21/master
      </div>
    )
  }
}
